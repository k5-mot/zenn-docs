---
title: "ACM"
---

# ACM (AWS Certificate Manager)とは？
- AWSサービスで利用する証明書を管理するサービス。
- 外部で発行した証明書の登録やAWS独自の証明書の発行を行い、AWSサービスで使えるようにする。

# HTTPSとは？
- HTTPを暗号化して安全に通信するための仕組み
  - 盗聴防止
  - 改ざん防止
  - なりすまし防止

# HTTPSの仕組み
- SSLやTLSといったプロトコルを使って暗号化する
  - SSLは古いやつで、TLSはSSLを新しくしたもの。ほぼバージョン違いらしい。
1. ローカルマシンがWebサーバにアクセス
2. Webサーバがサーバ証明書をローカルマシンに送付
3. ルート証明書とWebサーバから取得したサーバ証明書を比較検証
4. 公開鍵暗号方式で、公開鍵(サーバ証明書)を用いて、共通鍵を交換
5. 共通鍵暗号方式で、共通鍵を用いて、SSL/TLS通信する
- 共通鍵交換に使う公開鍵/秘密鍵は、第三者機関(認証局)による発行が必要である。
  - 第三者が介在する公開鍵基盤をPKI(Public Key Infracture)と呼ぶ。
  - 公開鍵のことを証明書と呼ぶ。
1. サーバが公開鍵と秘密鍵を生成
2. サーバが公開鍵を認証局に登録
3. 認証局が公開鍵と秘密鍵を生成
4. 認証局が認証局の秘密鍵とサーバの公開鍵からサーバ証明書を作成
5. 認証局が生成したサーバ証明書を、サーバが取得

# ACMでのサーバ証明書の発行手順
以下の手順をアジアパシフィック(東京)リージョン`ap-northeast-1`、
米国東部(バージニア北部)リージョン`us-east-1`の2つのリージョンで行う。(9章、CloudFrontで使う。)
1. 「AWS Certificate Manager (ACM)」を開き、「証明書のリクエスト」
2. 「証明書タイプ」に「パブリック証明書をリクエスト」、「次へ」
3. 「パブリック証明書をリクエスト」
- ドメイン名：`example.com (購入したドメイン名)`, `*.example.com`
- 検証方法：DNS 検証
- キーアルゴリズム：RSA 2048

# サーバ証明書に対応するDNSの設定
1. 「AWS Certificate Manager (ACM)」の「証明書を一覧」を開き、作成した証明書をクリック。
2. 「ドメイン」項目の「Route 53 でレコードを作成」をクリック
3. 2つのドメインをチェックして、「レコードを作成」
4. 「Route 53」の「ホストゾーン」を開き、作成したホストゾーンをクリック
5. 2つのドメインのCNAMEレコードが作成されているか確認

# SSL/TLSターミネーションとは？
- SSL/TLS通信を復号して生の電文に戻すこと
  - 復号されるので、通信の中身を検閲して怪しい通信を検知/遮断できる
  - 暗号化処理がなくなるので、ネットワーク負荷が下げられる
- 例えば、SSL/TLSの終端をELBが行う場合を考える
  - HTTPS：User - IGW - ELB
  - HTTP：ELB - EC2 (VPC内部)

# ELBにサーバ証明書を設定
1. 「EC2」の「ロードバランシング」の「ロードバランサー」を開く。
2. 作成したロードバランサーを開く。
3. 「リスナーとルール」で「リスナーの追加」
- リスナーの詳細
  - リスナーの設定
    - プロトコル：HTTPS, 443
  - デフォルトアクション
    - アクションのルーティング：ターゲットグループへ転送
    - ターゲットグループ："作成したTG"
- セキュアリスナーの設定
  - デフォルト SSL/TLS サーバー証明書
    - 証明書の取得先：ACM から
    - 証明書 (ACM から)："作成したサーバ証明書"
4. ブラウザでアクセスできることを確認
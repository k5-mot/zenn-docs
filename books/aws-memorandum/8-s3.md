---
title: "S3"
---

# Amazon S3 (Amazon Simple Storage Service)とは？
- 長期的なデータ保管を目的としたストレージサービス
- 99.999999999% (9x11)のデータ耐久性がある

# S3の機能
- データの保管
  - 「バケット」と呼ばれる箱の中に、キーバリュー形式でデータを保管
  - 「バケット」の中は「フォルダ」を作ってファイル整理ができる
  - 「バケット」の名前はグローバルで一意にする必要がある
- データの取り出し
  - 複数のEC2からアクセス可能
  - 外部へ静的コンテンツとして配信可能
  - アクセス制御はフォルダ単位で可能

# S3の用途
- バックアップ
  - RDS ⇒ S3
- 災害対策(DR: Disaster Recovery)
  - RDS ⇒ S3(東京) ⇒ S3(大阪)
- データレイク
  - CloudFront, ELB, EC2 ⇒ S3 (とりあえずデータをぶち込んどくみたいなニュアンス)
- 静的コンテンツ配信
  - S3 ⇒ Users

# S3の2つのストレージ
- ブロックストレージ(EBS)
  - ローカルディスクのようにサーバインスタンスにマウントできるストレージ
- オブジェクトストレージ(S3)
  - 様々な場所から読み書きできる長期保管を目的としたストレージ

# S3 バケット作成手順
1. 「Amazon S3」の「バケット」を開く
2. 「汎用バケット」で「バケットを作成」
- 一般的な設定
  - AWS リージョン：ap-northeast-1
  - バケットタイプ：汎用
  - バケット名：`service-dev-public-bucket (グローバルで一意な命名)`
3. 「バケットを作成」
4. 作成したバケットを開き、「オブジェクト」タブでアップロードするファイルをドラッグアンドドロップする

:::message alert
S3は、ファイルサイズとPUT/GETで課金額が決まる。
静的コンテンツは、ランディングページ(最初に見るページ)で使うのが吉。
:::

# S3のアクセス権の設定
- 基本制御 (パブリックアクセス制御)
  - パブリック公開するか？を制御する
  - 「ブロックパブリックアクセス」で設定する
- 詳細アクセス制御
  - 公開するときの細かな制御
  - アクセスコントロールリスト (ACL)
    - あらかじめ決められたグループに対する一覧表示、ファイル操作の制御などの、大まかなアクセス制御を行う
  - バケットポリシー
    - 誰がどのリソースに対してどんな操作ができるのかなどの、より詳細なアクセス制御を行う

# ARNについて
- AWS内で作成されるリソースを一意に特定するキー
  - `arn:aws:<service>:<region>:<accountId>:<resourceID>`

# アクセス権の設定手順
1. 「AWS S3」の「バケット」で、作成したバケットを開く
2. 「アクセス許可」タブの「ブロックパブリックアクセス (バケット設定)」を「編集」
- 「パブリックアクセスをすべて ブロック」をアンチェック
3. 「バケットポリシー」を「編集」
- 以下は、あくまで例
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "Statement1",
			"Principal": "*",　// 誰に対するアクセス制御かを示す。"*"は全てからを意味する。
			"Effect": "Allow", // AWSは基本が操作無効なので、許可したいもののみ設定する
			"Action": [
				"s3:GetObject" // どんな操作を許可するのかを設定。s3:GetObjectはオブジェクト内容の取得を意味する。
			],
			"Resource": ["arn:aws:s3:::<S3のバケット名>/*"] // どのリソースに対する制御か指定。指定にはarnと呼ばれるリソース名を使用する。
		}
	]
}
```

# アップロードしたリソースの削除
1. 「AWS S3」の「バケット」で、作成したバケットを開く
2. 「オブジェクト」から、削除するファイルをチェック、「削除」

# 静的コンテンツのS3の配置手順
1. 静的コンテンツ配信用S3バケットを作成
2. S3に静的コンテンツを配置
3. アクセス制御設定

---
title: "CloudWatch"
---

# Amazon CloudWatchとは？
- システムモニタリングサービス
- CloudWatchとは、AWSが提供する(EC2やRDSなど)のシステムリソースをモニタリングするサービス
- AWSの他サービスと連携して利用する

# 何がモニタリングできるのか？
- AWSが提供するほぼすべてのサービスをモニタリングできる
- 監視できる項目のことを「メトリクス」と呼ぶ
  - CloudFront
    - リクエスト数、エラー率など
  - S3
    - オブジェクト数、オブジェクトサイズなど
  - ELB
    - 応答時間、200応答数など
  - EC2
    - CPU使用率など
  - RDS
    - CPU使用率、I/O時間など
- CloudWatchは、リージョン別に設定する

# メトリクスの確認方法
rds read/write latency
1. まねこんから、CloudWatchを開く
2. メトリクス、すべてのメトリクスを開く
3. ec2-インスタンス別メトリクスを日r九RDS
4. 実行中のインスタンスIDを取得し、検索窓に
5. CPUUtilizrtionをチェック、グラフに表示される
   1. 基本、5分間隔でメトリクスを収集する
   2. EC2作成字に、メトリクスの収集間隔を決められる(1分感覚とか)
6. CloudFrontは、バージニア北部にリージョンをhennkousitemiru

# イベント駆動とは？

- イベントとは？
  - event
  - システムの状態が変更されたことを示すシグナル
- イベント駆動とは？
  - 「プロデューサー」によって発火される「イベント」を「コンシューマー」が観察し、検知したら動作する仕組み。
- イベント駆動にするメリット
  - 疎結合にできる
    - 抽象化によって、システム間の依存関係を希薄にできる
    - これまでのシステム
      - 各インターフェースが密結合
    - イベント駆動
      - イベントという抽象化された情報を介して結合
  - 応答性能の改善
    - 非同期化による応答性の改善
      - これまで
        - 処理が同期的に行われる
      - イベント駆動
        - 非同期になることで応答が良くなる
  - 弾力性の改善
    - イベントストアによる弾力性の改善
      - これまで
        - 同期的に処理できるだけのリソースが必要
      - イベント駆動
        - キューを介することで処理物量を意図的にコントロールでき、平準化できる。ため込むことができる
- CloudWatch とイベント
  - CloudWatch = プロデューサー
  - AWS SNS 、Auto Scaling = コンシューマー(アクションする側)


# Amazon SNS (Simple Notification Service)とは？
- 通知サービス
- イベントがトリガーされると、メールやSMSなどの通知を行う。
- 通知の種類や手段をまとめたもの

## トピック、サブスクリプション
- CloudWatch ← 観察 ← SNS
- CloudWatch → アラート → SNS

- SNSがアラートを受け取る口を、トピックという
  - イベントを受け取る単位をトピックという
- SNSで発信する先をサブスクリプションという
  - イベントを受けて通知する先を、サブスクリプションという


# トピック、サブスクリプションの作成手順
ELBへ一定回数リクエストが存在すると、CloudWatchが検出し、SNSでメール送信する設定を入れる
1. SNS - トピックを開く
- タイプ：スタンダード
- 名前：tastylog-dev-elb-request-count-email-topic
2. サブスクリプションの作成
- トピックARN：作成したトピック
- プロトコル:email
- エンドポイント：k5.mot.888+aws@gmail.com
3. サブスクリプションが保留中の確認になる
4. 認証メールが来るので、受理する

# アラームの作成手順
1. Cloudwatch -  アラーム- すべてのアラームを開く
2. アラームの作成をクリック
3. メトリクスの選択
4. ApplicationELB - AppELB 別、TG 別メトリクス - RequestCountをチェック
5. 閾値0.03を設定 - [次へ]
6. 通知
- あらーむじょうたい
- 既存のトピック
- 送信先：作成したトピック
7. 名前：tastylog-dev-elb-request-count-high-cw-alarm
8.  適当にelbをアクセス、アラーム欄が「アラーム状態」となっている
9.  メールにアラートメールが受信